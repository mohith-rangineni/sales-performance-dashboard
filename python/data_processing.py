"""\nSales Performance Dashboard - Data Processing Script\nThis script processes raw sales data and prepares it for dashboard visualization\nIncludes filtering capabilities for interactive dashboard features\n"""\n\nimport pandas as pd\nimport numpy as np\nfrom datetime import datetime, timedelta\n\nclass SalesDataProcessor:\n    """\n    Process sales data with interactive filtering capabilities\n    Supports: Date range, Region, Product category, and Salesperson filters\n    """\n    \n    def __init__(self, data_path):\n        """Initialize with path to sales data CSV"""\n        self.df = pd.read_csv(data_path)\n        self.df['date'] = pd.to_datetime(self.df['date'])\n        \n    def apply_filters(self, start_date=None, end_date=None, \n                     region=None, category=None, salesperson=None):\n        """\n        Apply interactive filters to the dataset\n        \n        Parameters:\n        - start_date: Filter start date (YYYY-MM-DD)\n        - end_date: Filter end date (YYYY-MM-DD)\n        - region: Filter by region (North, South, East, West)\n        - category: Filter by product category\n        - salesperson: Filter by salesperson name\n        \n        Returns:\n        - Filtered DataFrame\n        """\n        filtered_df = self.df.copy()\n        \n        # Date range filter\n        if start_date:\n            filtered_df = filtered_df[filtered_df['date'] >= pd.to_datetime(start_date)]\n        if end_date:\n            filtered_df = filtered_df[filtered_df['date'] <= pd.to_datetime(end_date)]\n            \n        # Region filter\n        if region:\n            if isinstance(region, list):\n                filtered_df = filtered_df[filtered_df['region'].isin(region)]\n            else:\n                filtered_df = filtered_df[filtered_df['region'] == region]\n                \n        # Category filter\n        if category:\n            if isinstance(category, list):\n                filtered_df = filtered_df[filtered_df['category'].isin(category)]\n            else:\n                filtered_df = filtered_df[filtered_df['category'] == category]\n                \n        # Salesperson filter\n        if salesperson:\n            if isinstance(salesperson, list):\n                filtered_df = filtered_df[filtered_df['salesperson'].isin(salesperson)]\n            else:\n                filtered_df = filtered_df[filtered_df['salesperson'] == salesperson]\n                \n        return filtered_df\n    \n    def calculate_kpis(self, filtered_df=None):\n        """Calculate key performance indicators"""\n        if filtered_df is None:\n            filtered_df = self.df\n            \n        kpis = {\n            'total_revenue': filtered_df['sales_amount'].sum(),\n            'total_units': filtered_df['units_sold'].sum(),\n            'avg_deal_size': filtered_df['sales_amount'].mean(),\n            'transaction_count': len(filtered_df),\n            'unique_customers': filtered_df['customer_id'].nunique()\n        }\n        \n        return kpis\n    \n    def revenue_by_region(self, filtered_df=None):\n        """Calculate revenue breakdown by region"""\n        if filtered_df is None:\n            filtered_df = self.df\n            \n        return filtered_df.groupby('region').agg({\n            'sales_amount': 'sum',\n            'units_sold': 'sum',\n            'customer_id': 'nunique'\n        }).reset_index()\n    \n    def revenue_by_category(self, filtered_df=None):\n        """Calculate revenue breakdown by product category"""\n        if filtered_df is None:\n            filtered_df = self.df\n            \n        return filtered_df.groupby('category').agg({\n            'sales_amount': 'sum',\n            'units_sold': 'sum',\n            'product': 'count'\n        }).reset_index()\n    \n    def top_salespeople(self, filtered_df=None, n=5):\n        """Get top N salespeople by revenue"""\n        if filtered_df is None:\n            filtered_df = self.df\n            \n        return filtered_df.groupby('salesperson').agg({\n            'sales_amount': 'sum',\n            'units_sold': 'sum',\n            'customer_id': 'nunique'\n        }).sort_values('sales_amount', ascending=False).head(n).reset_index()\n    \n    def monthly_trend(self, filtered_df=None):\n        """Calculate monthly revenue trend"""\n        if filtered_df is None:\n            filtered_df = self.df\n            \n        filtered_df['month'] = filtered_df['date'].dt.to_period('M')\n        monthly = filtered_df.groupby('month').agg({\n            'sales_amount': 'sum',\n            'units_sold': 'sum'\n        }).reset_index()\n        \n        # Calculate month-over-month growth\n        monthly['revenue_growth'] = monthly['sales_amount'].pct_change() * 100\n        \n        return monthly\n    \n    def target_achievement(self, filtered_df=None):\n        """Calculate target achievement by salesperson"""\n        if filtered_df is None:\n            filtered_df = self.df\n            \n        achievement = filtered_df.groupby('salesperson').agg({\n            'sales_amount': 'sum',\n            'monthly_target': 'first'\n        }).reset_index()\n        \n        achievement['achievement_pct'] = (\n            achievement['sales_amount'] / achievement['monthly_target'] * 100\n        )\n        achievement['variance'] = (\n            achievement['sales_amount'] - achievement['monthly_target']\n        )\n        \n        return achievement.sort_values('achievement_pct', ascending=False)\n\n\n# Example usage demonstrating interactive filtering\nif __name__ == "__main__":\n    # Initialize processor\n    processor = SalesDataProcessor('../data/raw/sales_data.csv')\n    \n    # Example 1: Filter by date range\n    q1_data = processor.apply_filters(\n        start_date='2024-01-01',\n        end_date='2024-03-31'\n    )\n    print("Q1 KPIs:", processor.calculate_kpis(q1_data))\n    \n    # Example 2: Filter by region\n    north_data = processor.apply_filters(region='North')\n    print("\\nNorth Region Revenue:", processor.calculate_kpis(north_data))\n    \n    # Example 3: Multiple filters\n    electronics_east = processor.apply_filters(\n        category='Electronics',\n        region='East',\n        start_date='2024-06-01'\n    )\n    print("\\nElectronics in East (June+):", processor.calculate_kpis(electronics_east))\n    \n    # Example 4: Salesperson performance\n    sarah_data = processor.apply_filters(salesperson='Sarah Johnson')\n    print("\\nSarah Johnson Performance:", processor.calculate_kpis(sarah_data))\n
